SELECT
    TO_NVARCHAR(CREATEDON, 'YYYY-MM') AS SUBMISSION_MONTH,
    COUNT(*) AS TOTAL_SUBMISSIONS,
    SUM(CASE WHEN LISTINGINDICATOR = 'LI' THEN 1 ELSE 0 END) AS LISTING_COUNT,
    SUM(CASE WHEN LISTINGINDICATOR = 'DL' THEN 1 ELSE 0 END) AS DELISTING_COUNT
FROM
    ZS2A_LISTAPR_HDR
WHERE
    COUNTRYID = 'AU'
    AND CREATEDON >= ADD_MONTHS(CURRENT_DATE, -12)
    AND (PRODUCEINDICATOR IS NULL OR PRODUCEINDICATOR <> 'PR')
GROUP BY
    TO_NVARCHAR(CREATEDON, 'YYYY-MM')
ORDER BY
    SUBMISSION_MONTH;
