SELECT DISTINCT
    RIGHT(MARA.MATNR, 6) DISPLAY,
    CASE
        WHEN COMP.ATTYP = '00' THEN RIGHT(COMP.MATNR, 6)
        WHEN COMP.ATTYP = '02'                             THEN RIGHT(COMP.MATNR, 9) else ''
    END AS SELLABLE_ID,
    MAKTC.MAKTX SELLABLE_DESCRIPTION,
    T024.EKNAM BUYING_DIRECTOR,
    ekko.KDATB CONTRACT_START_DATE,
    ekko.KDATE CONTRACT_END_DATE
FROM MARA

LEFT JOIN MVKE ON MVKE.MATNR = MARA.MATNR AND MVKE.VKORG = 5998 AND MVKE.VTWEG = 10
LEFT JOIN MAST ON MAST.MATNR = MARA.MATNR
LEFT JOIN STPO ON STPO.STLNR = MAST.STLNR
LEFT JOIN MARA COMP ON COMP.MATNR = STPO.IDNRK
LEFT JOIN MAKT ON MAKT.MATNR = MARA.MATNR AND MAKT.SPRAS = 'E'
LEFT JOIN MAKT MAKTC ON MAKTC.MATNR = COMP.MATNR AND MAKTC.SPRAS = 'E'
LEFT JOIN T024 ON T024.EKGRP = MVKE.ZZPRGRP

left join EKPO ON EKPO.MATNR = MARA.MATNR

inner join EKKO ON EKKO.EBELN = EKPO.EBELN
    

WHERE
    MARA.MTART = 'Z100'
    AND MARA.ATTYP = 12
    AND LEFT(MVKE.PRODH, 5) <> '00002'
    AND MVKE.VKORG = '5998'
    AND EKKO.BSTYP = 'K'
    AND EKKO.LOEKZ != 'L'
    AND EKKO.KDATB BETWEEN ADD_DAYS(CURRENT_DATE, -7) AND ADD_DAYS(CURRENT_DATE, 35)
    and comp.ATTYP in ('00', '02')
 
ORDER BY
    DISPLAY
